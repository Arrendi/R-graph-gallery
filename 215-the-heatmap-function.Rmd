---
title: "Building heatmap with R"
descriptionMeta: "A complete explanation on how to build heatmaps with R: how to use the heatmap() function, how to custom appearance, how to normalize data and more."
descriptionTop: "A complete explanation on how to build [heatmaps](heatmap.html) with basic R: how to use the `heatmap()` function, how to custom appearance, how to normalize data and more."
sectionText: "Heatmap section"
sectionLink: "heatmap.html"
DataToVizText: "Heatmap best practice"
DataToVizLink: "data-to-viz.com/graph/heatmap.html"
url: "215-the-heatmap-function"
output:
  html_document:
      self_contained: false    
      mathjax: default
      lib_dir: libs
      template: template_rgg.html
      css: style.css
      toc: TRUE
      toc_float: TRUE
      toc_depth: 2
      df_print: "paged"
---


```{r global options, include = FALSE}
knitr::opts_chunk$set( warning=FALSE, message=FALSE)
```

<div class="container">




# Most basic Heatmap
***

<div class = "row">

<div class = "col-md-6  col-sm-12 align-self-center">

<u>How to do it</u>: below is the most basic [heatmap](heatmap.html) you can build in base R, using the `heatmap()` function with no parameters. Note that it takes as input a matrix. If you have a data frame, you can convert it to a matrix with `as.matrix()`, but you need numeric variables only.

<u>How to read it</u>: each column is a variable. Each observation is a row. Each square is a value, the closer to yellow the higher. You can transpose the matrix with `t(data)` to swap X and Y axis.

<u>Note</u>: as you can see this heatmap is not very insightful: all the variation is absorbed by the `hp` and `disp` variables that have very high values compared to the others. We need to normalize the data, as explained in the next section.

</div>


<div class = "col-md-6  col-sm-12">

```{r thecode, echo=FALSE, out.width = "100%", fig.height=7}
# The mtcars dataset:
data <- as.matrix(mtcars)

# Default Heatmap
heatmap(data)
```
</div>
</div>



```{r thecode, eval=FALSE}
```




# Normalization
***

<div class = "row">

<div class = "col-md-6  col-sm-12 align-self-center">

Normalizing the matrix is done using the `scale` argument of the `heatmap()` function. It can be applied to `row` or to `column`. Here the `column` option is chosen, since we need to absorb the variation between column.


</div>


<div class = "col-md-6  col-sm-12">

```{r thecode2, echo=FALSE, out.width = "100%", fig.height=7}
# Use 'scale' to normalize
heatmap(data, scale="column")
```
</div>
</div>



```{r thecode2, eval=FALSE}
```











# Dendrogram and Reordering
***

<div class = "row">

<div class = "col-md-6  col-sm-12 align-self-center">

You may have noticed that order of both rows and columns is different compare to the native `mtcar` matrix. This is because `heatmap()` reorders both variables and observations using a clustering algorithm: it computes the distance between each pair of rows and columns and try to order them by similarity. 

Moreover, the corresponding `dendrograms` are provided beside the heatmap. We can avoid it and just visualize the raw matrix: use the `Rowv` and `Colv` arguments as follow.

</div>


<div class = "col-md-6  col-sm-12">

```{r thecode3, echo=FALSE, out.width = "100%", fig.height=7}
# No dendrogram nor reordering for neither column or row
heatmap(data, Colv = NA, Rowv = NA, scale="column")
```
</div>
</div>



```{r thecode3, eval=FALSE}
```










# Normalization
***

<div class = "row">

<div class = "col-md-6  col-sm-12 align-self-center">

Normalizing the matrix is done using the `scale` argument of the `heatmap()` function. It can be applied to `row` or to `column`. Here the `column` option is chosen, since we need to absorb the variation between column.


</div>


<div class = "col-md-6  col-sm-12">

```{r thecode4, echo=FALSE, out.width = "100%", fig.height=7}
# Use 'scale' to normalize
heatmap(data, scale="column")
```
</div>
</div>



```{r thecode4, eval=FALSE}
```







<!-- Close container -->
</div>




```{r, echo=FALSE}
htmltools::includeHTML("htmlChunkRelatedCorrelation.html")
```
